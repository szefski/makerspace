{{$card := and (.Member.Billing) (.Member.Billing.Card)}}
  <div class="container">
    <div class="row">
      <div class="col-md-10 col-lg-8 col-xl-7">
        {{if .Member.Billing}}
        <section>
          <h4>Transactions history</h4>
          <div class="px-2 px-sm-3">
            {{with .Member.Billing.Get_transactions 8}}
            <table class="table table-sm table-striped">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Amount</th>
                  <th>Name</th>
                  <th>Approved</th>
                </tr>
              </thead>
              <tbody>
                {{range .}}
                <tr>  
                  <td>{{.Date.Format "2006-01-02"}}</td>
                  <td>${{.Amount | printf "%.2f"}}</td>
                  <td>{{.Name}}</td>
                  <td>
                    {{if .Approved}}
                    <span class="text-success">Yes</span>
                    {{else}}
                    <span class="text-danger">No</span>
                    {{end}}
                  </td>
                </tr>
                {{end}}
              </tbody>
            </table>
            {{else}}
            <p>You have no recent transactions.</p>
            {{end}}
            {{if .Member.Active}}
            <h5>Recurring payments</h5>
            <p>You have no recurring payments.</p>
            {{else}}
            {{end}}
            <h5>Missed payments</h5>
            <p>You have no missed payments.</p>
          </div>
        </section>
        <hr>
        {{end}}
        <section>
          {{with $card}}
                    <h4>Update credit card</h4>
                        <div class="row px-2 px-sm-3">
                            <p class="col-sm-9 mb-2 mb-sm-3 text-muted">
                                <strong>Current card:</strong> {{.Number}}<br>
                                <strong>Expiry:</strong> {{.ExpiryMonth}}/20{{.ExpiryYear}}
                            </p>
                            <form action="/member/billing" method="post" class="col-sm-3 mb-3 text-sm-right">
                                <button type="submit" name="delete-card" class="btn btn-warning">Delete</button>
                            </form>
                        </div>
                    {{else}}
                    <h4>Register credit card</h4>
                    {{end}}
                        <form action="/member/billing" method="post" id="credit-card" class="px-2 px-sm-3">
                            <div class="form-group row mb-2 mb-sm-3">
                                <label for="name" class="col-sm-4 col-form-label">Name</label>
                                <div class="col-sm-8">
                                    <input type="text" id="name" name="name" class="form-control" minlength="4" maxlength="32" required{{if not $card}} autofocus{{end}}>
                                    <small class="form-control-feedback"></small>
                                </div>
                            </div>
                            <div class="form-group row mb-2 mb-sm-3">
                                <label for="ccNumber" class="col-sm-4 col-form-label">Card number</label>
                                <div class="col-sm-8">
                                    <div class="input-group" data-beanstream-target="ccNumber_input">
                                        <span class="input-group-addon glyphicons glyphicons-credit-card"></span>
                                    </div>
                                    <small data-beanstream-target="ccNumber_error" class="form-control-feedback"></small>
                                </div>
                            </div>
                            <div class="form-group row mb-2 mb-sm-3">
                                <label for="ccExp" class="col-sm-4 col-form-label">Expiry <span class="font-weight-normal text-muted">(mm/yyyy)</span></label>
                                <div class="col-sm-8">
                                    <div class="input-group" data-beanstream-target="ccExp_input">
                                        <span class="input-group-addon glyphicons glyphicons-calendar"></span>
                                    </div>
                                    <small data-beanstream-target="ccExp_error" class="form-control-feedback"></small>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="ccCvv" class="col-sm-4 col-form-label">CVV</label>
                                <div class="col-sm-8">
                                    <div class="input-group" data-beanstream-target="ccCvv_input">
                                        <span class="input-group-addon glyphicons glyphicons-lock"></span>
                                    </div>
                                    <small data-beanstream-target="ccCvv_error" class="form-control-feedback"></small>
                                </div>
                            </div>
                            <script src="https://payform.beanstream.com/payfields/beanstream_payfields.js" data-submitForm="true"></script>
                            <button type="submit" class="btn btn-primary">
                                {{if not $card}}Register{{else}}Update{{end}}
                            </button>
                        </form>
                </section>
                <hr>
                <section>
                    <h4>Membership dues</h4>
                    <form id="billing" class="px-2 px-sm-3" method="post" action="/member/billing">
                        <fieldset class="form-group mb-2 mb-sm-3">
                            <label class="custom-control custom-radio">
                                <input type="radio" name="rate" class="custom-control-input" value="regular"{{if not .Member.Student}} checked{{end}}>
                                <span class="custom-control-indicator"></span>
                                <span class="custom-control-description"><b>Regular</b> ($50/month)</span>
                            </label>
                            <label class="custom-control custom-radio">
                                <input type="radio" id="student-rate" name="rate" class="custom-control-input" value="student"{{if .Member.Student}} checked{{end}}>
                                <span class="custom-control-indicator"></span>
                                <span class="custom-control-description"><b>Student</b> ($30/month)</span>
                            </label>
                        </fieldset>
                        <fieldset id="student"{{if not .Member.Student}}class="text-muted" disabled{{end}}>
                            <legend class="h5 mb-0 mb-sm-2">Student info</legend>
                            <div class="form-group row mb-2"> 
                                <label for="institution" class="col-sm-4 col-form-label">Institution name</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="institution" name="institution" {{if .Member.Student}} value="{{.Member.Student.Institution}}" required{{end}}>
                                    <small class="form-control-feedback"></small>
                                </div>
                            </div>
                            <div class="form-group row mb-sm-2">
                                <label for="graduation" class="col-sm-4 col-form-label">Expected graduation</label>
                                <div class="col-sm-8">
                                    <input type="month" class="form-control" id="graduation" name="graduation"{{if .Member.Student}} value="{{.Member.Student.Grad_date.Format "2006-01"}}" required{{end}}>
                                    <small class="form-control-feedback"></small>
                                </div>
                            </div>
                        </fieldset>
                        <button type="submit" name="register" class="btn btn-primary"{{if not $card}} disabled{{end}}>
                            {{if .Member.Active}}Update{{else}}Register{{end}}
                        </button>
                        {{if not $card}}
                        <span class="text-danger ml-3">You must register a credit card.</span>
                        {{end}}
                        {{if .Member.Active}}
                        <button type="submit" name="terminate" class="btn btn-danger">Terminate</button>
                        {{end}}
                    </form>
                </section>
            </div>
        </div>
{{template "footer"}}
    </div>
